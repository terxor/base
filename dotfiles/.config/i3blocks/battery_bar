#!/bin/bash

capacity=$(cat /sys/class/power_supply/BAT0/capacity)
status=$(cat /sys/class/power_supply/BAT0/status)

# Bar config
total_slots=10
filled_slots=$((capacity * total_slots / 100))
empty_slots=$((total_slots - filled_slots))

# Determine arrow symbol
arrow=""
case "$status" in
    "Charging") arrow=">" ;;
    "Discharging") arrow="<" ;;
esac

# Adjust bar if arrow is present
if [[ -n "$arrow" && $filled_slots -gt 0 ]]; then
    filled_slots=$((filled_slots - 1))
    bar="["
    bar+=$(printf '=%.0s' $(seq 1 $filled_slots))
    bar+="$arrow"
else
    bar="["
    bar+=$(printf '=%.0s' $(seq 1 $filled_slots))
fi

# Add remaining spaces
bar+=$(printf ' %.0s' $(seq 1 $((total_slots - ${#bar} + 1))))
bar+="]"

if (( capacity <= 10 )); then
    fill_color="#FF0000"  # Red
elif (( capacity <= 20 )); then
    fill_color="#FF3300"
elif (( capacity <= 30 )); then
    fill_color="#FF6600"
elif (( capacity <= 40 )); then
    fill_color="#FF9900"
elif (( capacity <= 50 )); then
    fill_color="#FFCC00"  # Orange-yellow
elif (( capacity <= 60 )); then
    fill_color="#FFFF00"  # Yellow
elif (( capacity <= 70 )); then
    fill_color="#CCFF00"
elif (( capacity <= 80 )); then
    fill_color="#99FF00"
elif (( capacity <= 90 )); then
    fill_color="#66FF00"
else
    fill_color="#00FF00"  # Green
fi

# Output (need to output color in 3rd line)
echo "$bar"
echo "$bar"
echo "$fill_color"
